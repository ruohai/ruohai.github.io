<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>202412s on 喵ฅ^•ﻌ•^ฅ</title>
    <link>https://ruohai.wang/202412/</link>
    <description>Recent content in 202412s on 喵ฅ^•ﻌ•^ฅ</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-cn</language>
    <lastBuildDate>Thu, 05 Dec 2024 15:18:39 +0800</lastBuildDate><atom:link href="https://ruohai.wang/202412/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>PhotoPrism缺点大吐槽：哪哪都不行，建议弃用</title>
      <link>https://ruohai.wang/202412/photoprism-complains/</link>
      <pubDate>Thu, 05 Dec 2024 15:18:39 +0800</pubDate>
      
      <guid>https://ruohai.wang/202412/photoprism-complains/</guid>
      <description>前言 先声明：从去年的7~8月份我开始折腾自建相册，当时对比了immich最后选择了photoprism，至今也用了一年半的时间了，所以算是个老用户了，不是简单新手向的吐槽。
为什么用了一年半以后才开始写这个吐槽文，因为我自己用java写了一个小服务来处理照片归档，所以最后一个对pp的依赖也没有了，终于可以把pp从我的服务器上remove掉惹。
在放弃pp的这一刻，写篇文章记录一下我在使用pp的过程中碰到的几个超级大槽点。
超级大槽点 槽点一：照片统一重命名都按照UTC时区处理
这个是pp归档照片时最大的bug。
pp有个功能，就是按照统一规则生成一个唯一的文件名将照片进行重命名，所以最后的文件名都是yyyyMMdd_HHmmss_xxxxxxxx.jpg这种格式，其中最后8位x应该是类似md5一样根据文件生成的8位字符串。
这个功能很好用，也是强制启用的功能。按照这个规则重命名以后的照片/视频，根据文件名就能很方便的知道文件的创建时间，而且也统一了文件名，看上去很干净规整。
但是这个功能有个很大的bug！！！！
pp是按照utc时区来生成的文件名，也就是正确的照片时间需要减去8个小时来生成文件名！！！
比如某时某刻我拍了一张jpg照片，拍摄时间是2024年12月5日15点36分44秒，那照片归档正确的文件名应该是20241205_153644_xxxxxxxx.jpg。但是pp会无视照片exif中的时区信息，而是按照utc时区生成文件名，也就是北京时间减去8个小时，最后就变成了20241205_073644_xxxxxxxx.jpg。
(╯‵□′)╯︵┻━┻
不过，比起原始照片文件各种乱七八糟无规则、无意义、自然递增的文件名格式，现在这个文件名只是时间少了8个小时，好像也不是太大的问题。
那就要配合上下面这个大杀器！
槽点二：照片归档也按照UTC时区处理
pp归档图片和视频文件时，是根据文件的创建时间，按照yyyy/mm的目录结构来归档文件的。
但是由于槽点一的存在，又导致了一种情况：
月初拍的照片有可能被归档到上个月！比如，2024年12月1号早上7点拍的照片，减去8小时是2024年11月30号晚上11点，就被归档到2024/11目录惹 年初拍的照片可能被归档到上一年！比如：2024年1月1日早上7点拍的照片，减去8小时候是2023年12月31日晚上11点，就被归档到2023/12目录惹 这种情况下，如果在pp中搜索2024年12月份的照片，或者搜2024年的照片，这种错误归档的照片就搜不到了！！！
(╯‵□′)╯︵┻━┻
我在使用photoprism的这一年半时间里，也想过是不是我什么地方没设置正确，比如是不是docker-compose.yml中没有加timezone参数，是不是服务器的时间设置错误。我在官方wiki和官方github issue里也找过，但实在是个人能力有限，没有找到什么有用的解决方法。
但我又非常喜欢pp这个按照文件时间统一重命名、统一归档的功能，另外几个相册（比如immich）都没有这个功能，所以最后我不得不在有如此两个大槽点的情况继续坚持使用pp。
槽点三：重命名操作会修改文件的exif
以图片文件为例，图片的exif中，保存文件时间的大致有如下几个tag：
Date/Time Original：原始创建时间 Date/Time Digitized：数字化时间 File Modified Date：文件修改时间 如果是拍摄行为生成的照片（手机、相机等拍摄设备），exif中都会有这几个tag，pp应该也是优先读取前两个tag进行时间解析，然后按照这个时间（别忘了会减去8小时）生成文件名。
但如果是非拍摄行为生成的图片（比如网上下载的图片、从微信保存的图片、各种截图），这种图片的exif中都没有前两个tag，只有File Modified Date保存了文件生成时间。对于这种图片，pp应该是读取File Modified Date，根据这个时间（依然要减去8个小时）生成文件名。如果读取的时间字符串无法正确解析，就会用当前时间生成文件名。
到这里似乎都没啥问题，有拍摄时间读取拍摄时间，没拍摄时间读取文件生成时间，无法读取文件生成时间就用当前时间。
但是，pp的骚操作又来啦！！！！
pp读取完时间生成新的文件名并对文件进行重命名以后，会把这个重命名操作的时间写入到exif的File Modified Date！！！！！
它对exif信息动手了！！！
这就导致了一个bug：文件每导入归档一次，它的File Modified Date都会被修改一次。如果是非拍摄行为生成的图片，File Modified Date这tag里保存的时间就代表着这张图片的创建时间，如此一改，这张图片的创建时间就变了。如果恰巧又碰到了pp无法正确解析File Modified Date中保存的时间信息，那这个文件就又会被归档到当前时间。
你可能会觉得奇怪，为什么会有傻x要把已经归档过的照片反复导入pp归档。
是我！是我！我就出现过这种操作！
比如我目前有8w个照片、图片、视频文件，全部导入pp进行归档，归档完成后删除了原始文件，保留了归档文件。然后很不幸我部署pp的系统崩了，但8w个已归档的文件还在。这时我重新部署一个pp，把8w个已经归档的文件又全部导入pp进行【二次归档】。
🤔🤔🤔🤔🤔🤔🤔🤔
这个时候我发现很多非拍摄行为生成的图片都被归档到当前时间惹！！！！！！
(╯‵□′)╯︵┻━┻
槽点四：图片算法识别功能很垃圾
pp作为一个完整的相册服务，也提供了图像算法识别功能，用来进行图像主体识别、人脸识别、自动标签、自动创建精彩时刻、图片质量打分等等智障功能。
但我实体使用下来的体验是：不好用，非常不好用。
不说和google、apple的图像识别算法对比，也不和国内各个手机厂商提供的手机智能相册比，只是和immich比，我都感觉差了很多。主体识别错误、检测不到人脸、自动标签错误，很难说达到可用级别。
对于pp的图像识别算法功能，我的点评是：能用但是不好用，徒增功耗、浪费算力，建议关闭。
槽点五：免费版pp的gps解析功能有限制
相信很多pp用户和我一样都是用的免费社区版（community）做自建相册，pp免费版也带了照片地图功能，根据照片exif中保存的gps信息显示照片的拍摄地并显示在地图上。
但是，但是，pp的骚操作又又又来惹！！！
免费版pp根据gps坐标数据解析地理位置的api有请求数量限制！！！有rate limit！！！
也就是如果一次导入比较多的照片，很容易就达到这个reverse geocodeing接口的请求数量限制，这个api会直接报timeout错误让你以为是自己网络出了问题。</description>
    </item>
    
  </channel>
</rss>
