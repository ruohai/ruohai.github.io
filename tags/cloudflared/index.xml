<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Cloudflared on å–µà¸…^â€¢ï»Œâ€¢^à¸…</title>
    <link>https://ruohai.wang/tags/cloudflared/</link>
    <description>Recent content in Cloudflared on å–µà¸…^â€¢ï»Œâ€¢^à¸…</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-cn</language>
    <lastBuildDate>Wed, 05 Jun 2024 13:25:24 +0800</lastBuildDate><atom:link href="https://ruohai.wang/tags/cloudflared/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>åœ¨åˆ·äº†OpenWrtçš„è¿…é›·èµšé’±å®ä¸€ä»£ï¼ˆWS1408ï¼‰ä¸Šè¿è¡ŒCloudflared</title>
      <link>https://ruohai.wang/202406/cloudflared-install-on-openwrt/</link>
      <pubDate>Wed, 05 Jun 2024 13:25:24 +0800</pubDate>
      
      <guid>https://ruohai.wang/202406/cloudflared-install-on-openwrt/</guid>
      <description>ä¸Šä¸ªæœˆå·²ç»å†™è¿‡ä¸€ç¯‡åšå®¢è®°å½•æ€ä¹ˆåœ¨åˆ·äº†openwrtå›ºä»¶çš„è¿…é›·èµšé’±å®ä¸€ä»£ä¸Šé¢è¿è¡Œcloudflaredï¼Œä½†æ˜¯å†™é‚£ç¯‡æ–‡ç« çš„æ—¶å€™å¯¹sysvintçš„è„šæœ¬å®Œå…¨ä¸ç†Ÿæ‚‰ï¼Œåªæ˜¯ç…§è™ç”»çŒ«ï¼ˆç°åœ¨ä¹Ÿæ²¡æœ‰ä»€ä¹ˆè¿›æ­¥ğŸ˜‚ï¼‰ï¼Œä½†ç»è¿‡è¿™ä¸€æ®µæ—¶é—´çš„debugï¼Œå‘ç°äº†ï¼ˆçœ‹ä¸Šå»ï¼‰æ²¡ä»€ä¹ˆé—®é¢˜çš„è¿è¡Œæ–¹å¼ï¼Œæ‰€ä»¥æ›´æ–°ä¸€ä¸‹ã€‚
é¦–å…ˆè¿˜æ˜¯æ‰¾åˆ°cloudflaredçš„githubä»“åº“ä¸»é¡µã€cloudflare/cloudflaredã€‘ï¼Œåœ¨releaseé¡µé¢æ‰¾åˆ°é¢„ç¼–è¯‘çš„é€‚é…å„ç¡¬ä»¶å¹³å°çš„äºŒè¿›åˆ¶åŒ…ã€‚è¿…é›·èµšé’±å®ä¸€ä»£å¯ä»¥ç”¨armæˆ–è€…armhfï¼Œæˆ‘é€‰æ‹©ç”¨armhfã€‚
sshè¿ä¸Šopenwrtï¼Œä¸‹è½½åˆ°æœ¬åœ°
# ä¸‹è½½ wget -O cloudflared https://github.com/cloudflare/cloudflared/releases/download/2024.6.0/cloudflared-linux-armhf # æˆæƒ chmod +x cloudflared ç„¶ååœ¨/etc/init.dç›®å½•ä¸‹æ–°å»ºcloudflaredæ–‡ä»¶ï¼Œå½•å…¥ä»¥ä¸‹å†…å®¹ï¼Œæ³¨æ„æˆ‘çš„cloudflaredæ–‡ä»¶è·¯å¾„æ˜¯/mnt/data/cloudflared/cloudflaredï¼Œè¿˜æœ‰tokençš„å€¼ï¼Œéƒ½éœ€è¦ä½ æ ¹æ®è‡ªå·±çš„æƒ…å†µä¿®æ”¹ã€‚
#!/bin/sh /etc/rc.common START=99 STOP=10 SERVICE_WRITE_PID=1 SERVICE_USE_PID=1 SERVICE_DAEMONIZE=1 start() { service_start /mnt/data/cloudflared/cloudflared --pidfile /var/run/cloudflared.pid --autoupdate-freq 24h0m0s tunnel run --token [ä½ çš„token] } stop() { kill $(pidof cloudflared) } ä¿å­˜æ–‡ä»¶åé€€å‡ºï¼Œè®°å¾—chmod +x cloudflaredæˆæƒã€‚
ç„¶åå¯åŠ¨å¹¶æ·»åŠ å¼€æœºå¯åŠ¨é¡¹å³å¯ã€‚
# å¯åŠ¨ service cloudflared start # æ·»åŠ å¯åŠ¨é¡¹ service cloudflared enable æ³¨æ„æˆ‘çš„sysvinitè„šæœ¬ä¸­æ²¡æœ‰åªé€‚é…äº†startå’Œstopä¸¤ä¸ªå‘½ä»¤ï¼Œå…¶å®ƒçš„restartã€statusæ²¡æœ‰é€‚é…ï¼Œæœ‰éœ€æ±‚çš„è¯å¯ä»¥è‡ªè¡Œå¢åŠ ä»£ç ã€‚
ğŸ‰</description>
    </item>
    
    <item>
      <title>åœ¨åˆ·äº†OpenWrtçš„è¿…é›·èµšé’±å®ä¸€ä»£ï¼ˆWS1408ï¼‰ä¸Šéƒ¨ç½²Cloudflare Tunnel</title>
      <link>https://ruohai.wang/202404/cloudflared-install-on-openwrt/</link>
      <pubDate>Tue, 30 Apr 2024 13:14:36 +0800</pubDate>
      
      <guid>https://ruohai.wang/202404/cloudflared-install-on-openwrt/</guid>
      <description>å‰è¨€ æ‰‹ä¸Šçš„è¿…é›·èµšé’±å®ä¸€ä»£ï¼ˆws1408ï¼‰åˆ·äº†openwrtï¼Œç„¶åè£…äº†samba4ã€qbitã€wolã€filebrowserã€ttydã€minidlnaï¼Œé™¤äº†è¿™äº›ä»¥æ€»æƒ³ç€è¿˜èƒ½åœ¨è¿™ä¸ªç”µå­åƒåœ¾ä¸ŠæŒ–æ˜å‡ºä»€ä¹ˆåŠŸèƒ½ï¼Œæœ€åæƒ³åˆ°å®ƒä½œä¸ºä¸€ä¸ª24å°æ—¶å¼€æœºçš„ä¸‹è½½æœºï¼Œå†å¼„ä¸ªcloudflaredç»™æˆ‘çš„cloudflare tunnleåšå†—ä½™connectoræ˜¯ä¸ªä¸é”™çš„ä¸»æ„ã€‚
ä¹‹å‰çš„åšå®¢é‡Œæåˆ°è¿‡ï¼Œcloudflare tunnelçš„å®˜æ–¹æ–‡æ¡£é‡Œå°±å†™äº†ï¼Œæƒ³è¦æé«˜ä¸€ä¸ªtunnelçš„ç¨³å®šæ€§ï¼Œæœ‰èŠ±é’±çš„æ–¹æ¡ˆä¹Ÿæœ‰å…è´¹çš„æ–¹æ¡ˆï¼Œå…è´¹çš„æ–¹æ¡ˆå°±æ˜¯è‡ªå·±å¤šå¼„å‡ ä¸ªæœºå™¨è£…cloudflaredæ¥ä½œä¸ºtunnelçš„connectorï¼Œè¿™æ ·å“ªæ€•å…¶ä¸­ä¸€ä¸ªconnectorå´©äº†ï¼Œè¿˜æœ‰å…¶å®ƒå‡ ä¸ªconnectorå¤‡ä»½å¯ç”¨ã€‚
æˆ‘å®æµ‹ä¸€ä¸ªtunnelé…ç½®ä¸¤ä¸ªconnectorï¼ˆcloudflaredï¼‰å°±å†æ²¡è§è¿‡degradeæˆ–è€…downçš„æ ‡è¯†äº†ã€‚ä½†è¿™ç©æ„å¤šå¤šç›Šå–„ï¼Œ3ä¸ªæ€»æ˜¯æ¯”2ä¸ªç¨³å®šï¼Œé‚£å°±å¼€å§‹å§~
å®‰è£… ç¬¬ä¸€æ­¥ï¼šä¸‹è½½
openwrtè¯´åˆ°åº•è¿˜æ˜¯é­”æ”¹çš„linuxï¼Œæ‰€ä»¥æ‰¾åˆ°åˆé€‚ç‰ˆæœ¬çš„cloudflaredå°±è¡Œäº†ã€‚
å®æµ‹clouflareå®˜æ–¹æä¾›çš„äºŒè¿›åˆ¶åŒ…å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œé¡¹ç›®åœ°å€ï¼šã€cloudflare/cloudflaredã€‘
ws1408ç”¨çš„èŠ¯ç‰‡æ˜¯å¤§å®¶çš„è€æœ‹å‹amlogic s805ï¼Œæˆ‘ä»¬éƒ½å¾ˆç†Ÿæ‚‰å®ƒæ˜¯armv7l/armhfçš„æ¶æ„ã€‚
å¯ä»¥é€‰æ‹©å¤åˆ¶ä¸‹è½½é“¾æ¥ï¼Œç„¶åsshè¿ä¸Šopenwrtï¼Œå†ç”¨wgetä¸‹è½½ã€‚ä¹Ÿå¯ä»¥ç›´æ¥ä¸‹è½½åˆ°æœ¬åœ°ï¼Œç„¶åé€šè¿‡winscpæˆ–è€…å…¶å®ƒæ–¹æ³•ä¸Šä¼ åˆ°æœºå™¨ã€‚
æˆ‘åœ¨æœºå™¨ä¸Šæ’äº†ä¸€å¼ sdå¡æŒ‚è½½åˆ°/mnt/sdcardä½œä¸ºè½¯ä»¶å®‰è£…ç›®å½•ï¼Œå› ä¸ºws1408è‡ªå¸¦å­˜å‚¨åªæœ‰72MBå¤ªé‡‘è´µå•¦ã€‚
# è¿›å…¥ç›®å½• cd /mnt/sdcard/cloudflared # ä¸‹è½½ wget -O cloudflared https://github.com/cloudflare/cloudflared/releases/download/2024.4.1/cloudflared-linux-armhf # æ·»åŠ å¯æ‰§è¡Œæƒé™ chmod +x cloudflared ç¬¬äºŒéƒ¨ï¼šå®‰è£…
è½¯ä»¶ä¸‹è½½å®Œä»¥åï¼Œé¦–å…ˆéœ€è¦ç™»å½•cloudflareå®˜ç½‘ï¼Œè¿›å…¥tunnelé…ç½®é¡µé¢ï¼Œæ‰¾åˆ°è‡ªå·±çš„tunnelï¼Œåœ¨configureé¡µé¢çš„overviewæ ‡ç­¾é¡µï¼Œæ‰¾åˆ°è‡ªå·±çš„è¿™ä¸ªtunnelçš„tokenã€‚
æ‰“ç çš„å°±æ˜¯tokenäº†ï¼Œå¤åˆ¶ä»¥åå…ˆæ”¾ä¸€è¾¹å¤‡ç”¨ã€‚
ç„¶åä¾ç„¶æ˜¯sshè¿ä¸Šopenwrtï¼Œå¼€å§‹å®‰è£…
# è¿›ç›®å½• cd /mnt/sdcard/cloudflared # å®‰è£…æœåŠ¡ ./cloudflared service install [token] æ‰§è¡Œinstallå‘½ä»¤ä»¥åï¼Œç»ˆç«¯ä¼šæœ‰ä¸€äº›ä¿¡æ¯è¾“å‡ºï¼Œæç¤ºåœ¨ç¯å¢ƒå˜é‡$PATHä¸­æ‰¾ä¸åˆ°å¯æ‰§è¡Œæ–‡ä»¶ã€‚
è¿™é‡Œå¯ä»¥å…ˆä¸ç®¡å®ƒï¼Œæˆ‘ä»¬æ‰‹åŠ¨å¯åŠ¨ã€‚
# è¿›å…¥init.dç›®å½• cd /etc/init.d ç¡®å®šç›®å½•ä¸‹æœ‰cloudflaredçš„æœåŠ¡é…ç½®æ–‡ä»¶ã€‚
ç„¶åå¯åŠ¨cloudflared
service cloudflared start ç„¶åç”¨htopç¡®è®¤cloudflaredæ˜¯å¦å¯åŠ¨
åˆ°è¿™é‡Œå°±å®Œæˆåœ¨openwrtä¸Šå®‰è£…cloudflare tunnelçš„connectoræƒ¹ã€‚
ğŸ‰
ä¸€äº›å·²çŸ¥é—®é¢˜ æˆ‘çš„ws1408è£…çš„opwnwrtç‰ˆæœ¬æ˜¯21.02.7ï¼Œå†…æ ¸æ˜¯3.10.33ã€‚
æŒ‰ç…§ä¸Šæ–‡çš„æ–¹æ³•å®‰è£…å¥½cloudflaredä»¥åï¼Œå¯ä»¥å¯åŠ¨ï¼Œä½†æ˜¯æ²¡æ³•æŠŠå®ƒæ·»åŠ åˆ°å¼€æœºè‡ªå¯ã€‚æ‰§è¡Œservice cloudflared enableä¼šæç¤ºä¸æ”¯æŒenableå‘½ä»¤ã€‚
åœ¨openwrtçš„åå°â€”â€”å¯åŠ¨é¡¹ä¸­æ˜¾ç¤ºcloudflaredçš„å¯åŠ¨é¡¹æ˜¯ç¦ç”¨ï¼Œç‚¹å‡»å¯ç”¨ï¼Œä¼šæç¤ºå¯ç”¨å¤±è´¥ã€‚
å¦‚æœä½ ç†Ÿæ‚‰init.dçš„å¯åŠ¨è„šæœ¬è¯­æ³•ï¼Œå¯ä»¥è¯•è¯•è°ƒæ•´/etc/init.d/cloudflaredèƒ½å¦è§£å†³è¿™ä¸ªbugã€‚
æˆ‘ç”¨äº†å¦å¤–çš„åŠæ³•è§£å†³ï¼Œé‚£å°±æ˜¯åœ¨æœ¬åœ°å¯åŠ¨è„šæœ¬é‡Œæ‰‹åŠ¨æ·»åŠ ä¸€æ¡å‘½ä»¤ã€‚
service cloudflared start ğŸ˜‚</description>
    </item>
    
  </channel>
</rss>
