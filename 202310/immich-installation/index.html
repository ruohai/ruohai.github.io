<!doctype html>
<html lang="en-us">
  <head>
    <title>开源自托管相册服务Immich的安装 // 喵ฅ^•ﻌ•^ฅ</title>
    <link rel="shortcut icon" href="/favicon.ico" />
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.111.3">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="Ruohai Wang" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="/css/main.min.bbae4e4a160fe6ef61e422c4df808f31e024fd335c6703e79b07c797022fe282.css" />

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="开源自托管相册服务Immich的安装"/>
<meta name="twitter:description" content="前言 十多年来我用的相册服务一直都是google photos，大厂背书，早期宣传永久免费无限空间，而且也好用，往年今日、图像识别、关键字搜索，各种功能都很好用而且方便，如果gfw对你来说不是问题，这就是最好的方案。
不过很快它的权益就开始缩水，从原图永久免费空间，缩到高品质永久免费空间，缩到免费15GB空间。直到这两天，我发现gmail、driver、photos三者共用15GB空间，如果不续费，在空间耗尽的情况下，gmail都无法使用，因为没有空间来收发邮件了。
虽然可以用过订阅google one扩充空间，但我不喜欢这种被比较恶心的全家桶订阅制绑架用户的方案，尤其是当邮箱服务使用gmail，根本无法短时间之内迁移，迫使你不得不在清空photos腾出空间和花钱订阅之间二选一。
其实前几个月开始玩nas的时候就有考虑自建相册服务，很多方案，比如photo prism、piwigo、lychee、mt-photos、librephotos，但一直没有动手。因为这些方案对我来说都有几个比较致命的点：
无法使用原图片目录，需要通过【导入】重新存一份 不支持heic 相比起以上两点，其它的功能确实比如人脸识别、关键字搜索我都可以忽略不计。
但因为这几天被google one订阅之恶心到了，必须开始搞自建相册。
这篇文章记录下immich相册的安装过程。
安装 我的安装环境是debian 12 stable（bookworm）。权限、用户相关问题这里不多做标注，需自行解决。
immich的安装步骤在【官网】有文档，英语阅读无障碍的话可以直接看官网。
注意事项： 安装会占用5GB存储空间 immich自带的机器学习、图像识别算法、转码非常占用资源，内存至少4GB cpu性能无要求，但更强的cpu，上传、转码、图像识别、机器学习就会更快 immich支持intel qsv、nvidia nvenc、intel vaapi视频转码硬件加速 因为docker-hub被封，部署的时候拉镜像根本没速度，请改用国内镜像站，或者用VPN 写这篇文章的当下（2023/10/05），immich版本1.81，实测支持自定义图库位置，edit user界面有个external path设置项，可以填入自定义图库的位置。填写以后，immich从图库读取图片的metadata、生成缩略图、图像识别，不会动图库的目录结构和原图。 批量导入图片的方法请查看官网，入口：Bulk Upload (Using the CLI) 第一步：安装docker和docker compose。 apt install docker.io apt install docker-compose 第二步：在本地创建immich安装目录 mkdir immich cd immich 第三步：在immich目录下载安装所需文件 wget https://github.com/immich-app/immich/releases/latest/download/docker-compose.yml wget -O .env https://github.com/immich-app/immich/releases/latest/download/example.env 第四步：编辑.env文件。下载的默认.env文件内容如下所示。 # You can find documentation for all the supported env variables at https://immich.app/docs/install/environment-variables # The location where your uploaded files are stored UPLOAD_LOCATION=."/>

    <meta property="og:title" content="开源自托管相册服务Immich的安装" />
<meta property="og:description" content="前言 十多年来我用的相册服务一直都是google photos，大厂背书，早期宣传永久免费无限空间，而且也好用，往年今日、图像识别、关键字搜索，各种功能都很好用而且方便，如果gfw对你来说不是问题，这就是最好的方案。
不过很快它的权益就开始缩水，从原图永久免费空间，缩到高品质永久免费空间，缩到免费15GB空间。直到这两天，我发现gmail、driver、photos三者共用15GB空间，如果不续费，在空间耗尽的情况下，gmail都无法使用，因为没有空间来收发邮件了。
虽然可以用过订阅google one扩充空间，但我不喜欢这种被比较恶心的全家桶订阅制绑架用户的方案，尤其是当邮箱服务使用gmail，根本无法短时间之内迁移，迫使你不得不在清空photos腾出空间和花钱订阅之间二选一。
其实前几个月开始玩nas的时候就有考虑自建相册服务，很多方案，比如photo prism、piwigo、lychee、mt-photos、librephotos，但一直没有动手。因为这些方案对我来说都有几个比较致命的点：
无法使用原图片目录，需要通过【导入】重新存一份 不支持heic 相比起以上两点，其它的功能确实比如人脸识别、关键字搜索我都可以忽略不计。
但因为这几天被google one订阅之恶心到了，必须开始搞自建相册。
这篇文章记录下immich相册的安装过程。
安装 我的安装环境是debian 12 stable（bookworm）。权限、用户相关问题这里不多做标注，需自行解决。
immich的安装步骤在【官网】有文档，英语阅读无障碍的话可以直接看官网。
注意事项： 安装会占用5GB存储空间 immich自带的机器学习、图像识别算法、转码非常占用资源，内存至少4GB cpu性能无要求，但更强的cpu，上传、转码、图像识别、机器学习就会更快 immich支持intel qsv、nvidia nvenc、intel vaapi视频转码硬件加速 因为docker-hub被封，部署的时候拉镜像根本没速度，请改用国内镜像站，或者用VPN 写这篇文章的当下（2023/10/05），immich版本1.81，实测支持自定义图库位置，edit user界面有个external path设置项，可以填入自定义图库的位置。填写以后，immich从图库读取图片的metadata、生成缩略图、图像识别，不会动图库的目录结构和原图。 批量导入图片的方法请查看官网，入口：Bulk Upload (Using the CLI) 第一步：安装docker和docker compose。 apt install docker.io apt install docker-compose 第二步：在本地创建immich安装目录 mkdir immich cd immich 第三步：在immich目录下载安装所需文件 wget https://github.com/immich-app/immich/releases/latest/download/docker-compose.yml wget -O .env https://github.com/immich-app/immich/releases/latest/download/example.env 第四步：编辑.env文件。下载的默认.env文件内容如下所示。 # You can find documentation for all the supported env variables at https://immich.app/docs/install/environment-variables # The location where your uploaded files are stored UPLOAD_LOCATION=." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ruohai.wang/202310/immich-installation/" /><meta property="article:section" content="202310" />
<meta property="article:published_time" content="2023-10-05T16:35:47+08:00" />
<meta property="article:modified_time" content="2023-10-05T16:35:47+08:00" />


  </head>
  <body>
    <header class="app-header">
      <a href="https://ruohai.wang/"><img class="app-header-avatar" src="/avatar.jpg" alt="Ruohai Wang" /></a>
      <span class="app-header-title">喵ฅ^•ﻌ•^ฅ</span>
      <nav class="app-header-menu">
          <a class="app-header-menu-item" href="/">主页</a>
             - 
          
          <a class="app-header-menu-item" href="/tags/">标签</a>
             - 
          
          <a class="app-header-menu-item" href="/about/">关于</a>
      </nav>
      <p>这种失落会持久吗~</p>
      <div class="app-header-social">
        
          <a href="https://twitter.com/ruohai" target="_blank" rel="noreferrer noopener me">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-twitter">
  <title>Twitter</title>
  <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path>
</svg>
          </a>
        
      </div>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">开源自托管相册服务Immich的安装</h1>
      <div class="post-meta">
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Oct 5, 2023
        </div>
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          1 min read
        </div>
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <title>tag</title>
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line>
</svg>
              <a class="tag" href="https://ruohai.wang/tags/linux/">Linux</a>
              <a class="tag" href="https://ruohai.wang/tags/immich/">Immich</a>
        </div>
      </div>
    </header>
    <div class="post-content">
      <h2 id="前言">前言</h2>
<p>十多年来我用的相册服务一直都是google photos，大厂背书，早期宣传永久免费无限空间，而且也好用，往年今日、图像识别、关键字搜索，各种功能都很好用而且方便，如果gfw对你来说不是问题，这就是最好的方案。</p>
<p>不过很快它的权益就开始缩水，从原图永久免费空间，缩到高品质永久免费空间，缩到免费15GB空间。直到这两天，我发现gmail、driver、photos三者共用15GB空间，如果不续费，在空间耗尽的情况下，gmail都无法使用，因为没有空间来收发邮件了。</p>
<p>虽然可以用过订阅google one扩充空间，但我不喜欢这种被比较恶心的全家桶订阅制绑架用户的方案，尤其是当邮箱服务使用gmail，根本无法短时间之内迁移，迫使你不得不在清空photos腾出空间和花钱订阅之间二选一。</p>
<p>其实前几个月开始玩nas的时候就有考虑自建相册服务，很多方案，比如photo prism、piwigo、lychee、mt-photos、librephotos，但一直没有动手。因为这些方案对我来说都有几个比较致命的点：</p>
<ul>
<li>无法使用原图片目录，需要通过【导入】重新存一份</li>
<li>不支持heic</li>
</ul>
<p>相比起以上两点，其它的功能确实比如人脸识别、关键字搜索我都可以忽略不计。</p>
<p>但因为这几天被google one订阅之恶心到了，必须开始搞自建相册。</p>
<p>这篇文章记录下immich相册的安装过程。</p>
<hr>
<h2 id="安装">安装</h2>
<p>我的安装环境是debian 12 stable（bookworm）。权限、用户相关问题这里不多做标注，需自行解决。</p>
<p>immich的安装步骤在【<a href="https://immich.app/docs/install/docker-compose">官网</a>】有文档，英语阅读无障碍的话可以直接看官网。</p>
<h3 id="注意事项">注意事项：</h3>
<ul>
<li>安装会占用5GB存储空间</li>
<li>immich自带的机器学习、图像识别算法、转码非常占用资源，内存至少4GB</li>
<li>cpu性能无要求，但更强的cpu，上传、转码、图像识别、机器学习就会更快</li>
<li>immich支持intel qsv、nvidia nvenc、intel vaapi视频转码硬件加速</li>
<li>因为docker-hub被封，部署的时候拉镜像根本没速度，请改用国内镜像站，或者用VPN</li>
<li>写这篇文章的当下（2023/10/05），immich版本1.81，实测支持自定义图库位置，<code>edit user</code>界面有个<code>external path</code>设置项，可以填入自定义图库的位置。填写以后，immich从图库读取图片的metadata、生成缩略图、图像识别，不会动图库的目录结构和原图。</li>
<li>批量导入图片的方法请查看官网，入口：<a href="https://immich.app/docs/features/bulk-upload">Bulk Upload (Using the CLI)</a></li>
</ul>
<h4 id="第一步安装docker和docker-compose">第一步：安装docker和docker compose。</h4>
<pre tabindex="0"><code>apt install docker.io

apt install docker-compose
</code></pre><h4 id="第二步在本地创建immich安装目录">第二步：在本地创建immich安装目录</h4>
<pre tabindex="0"><code>mkdir immich

cd immich
</code></pre><h4 id="第三步在immich目录下载安装所需文件">第三步：在immich目录下载安装所需文件</h4>
<pre tabindex="0"><code>wget https://github.com/immich-app/immich/releases/latest/download/docker-compose.yml

wget -O .env https://github.com/immich-app/immich/releases/latest/download/example.env
</code></pre><h4 id="第四步编辑env文件下载的默认env文件内容如下所示">第四步：编辑<code>.env</code>文件。下载的默认<code>.env</code>文件内容如下所示。</h4>
<pre tabindex="0"><code># You can find documentation for all the supported env variables at https://immich.app/docs/install/environment-variables

# The location where your uploaded files are stored
UPLOAD_LOCATION=./library

# The Immich version to use. You can pin this to a specific version like &#34;v1.71.0&#34;
IMMICH_VERSION=release

# Connection secrets for postgres and typesense. You should change these to random passwords
TYPESENSE_API_KEY=some-random-text
DB_PASSWORD=postgres

# The values below this line do not need to be changed
###################################################################################
DB_HOSTNAME=immich_postgres
DB_USERNAME=postgres
DB_DATABASE_NAME=immich

REDIS_HOSTNAME=immich_redis
</code></pre><p>在最简单的配置模式下，只需要修改三个地方，其它都可以用默认设置。</p>
<ul>
<li>UPLOAD_LOCATION，上传/导入的文件保存路径，根据自己的实际存储路径修改</li>
<li>TYPESENSE_API_KEY，搜索引擎的api key，可以自行用命令生成随机字符串后填入</li>
<li>DB_PASSWORD，数据库密码，可以自行用命令生成随机字符串后填入</li>
<li>生成32位随机字符串的命令：<code>openssl rand -base64 32</code></li>
</ul>
<h4 id="第五步拉取镜像启动容器">第五步：拉取镜像，启动容器。</h4>
<p>到这一步执行以下命令以后，就会开始自动拉取镜像安装，等进度条跑完即可。</p>
<pre tabindex="0"><code>docker-compose up -d
</code></pre><p>本地一共会安装7个服务，明细如下：</p>
<pre tabindex="0"><code>REPOSITORY                                   SIZE
ghcr.io/immich-app/immich-server             1.77GB
ghcr.io/immich-app/immich-web                243MB
ghcr.io/immich-app/immich-machine-learning   1.74GB
ghcr.io/immich-app/immich-proxy              46.2MB
redis                                        27.4MB
postgres                                     235MB
typesense/typesense                          799MB
</code></pre><h4 id="第六步访问web">第六步：访问web。</h4>
<p>等上述步骤都完成后，在浏览器中访问immich，默认端口2283，地址:<code>http://host_ip:2283</code>，移动端app的服务器地址：<code>http://host_ip:2283/api</code>。</p>
<hr>
<h2 id="参考文章">参考文章</h2>
<ol>
<li>【实用的开源项目】使用服务器部署Immich，高颜值高性能的自托管照片和视频备份方案 <a href="https://zhuanlan.zhihu.com/p/645242381">https://zhuanlan.zhihu.com/p/645242381</a></li>
</ol>

    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
